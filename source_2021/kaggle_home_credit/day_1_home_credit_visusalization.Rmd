Show in New Window
Loading required package: lattice

Attaching package: ‘caret’

The following object is masked from ‘package:purrr’:

    lift

The following object is masked from ‘package:httr’:

    progress

data.table 1.14.2 using 1 threads (see ?getDTthreads).  Latest news: r-datatable.com
**********
This installation of data.table has not detected OpenMP support. It should still work but in single-threaded mode.
This is a Mac. Please read https://mac.r-project.org/openmp/. Please engage with Apple and ask them for support. Check r-datatable.com for updates, and our Mac instructions here: https://github.com/Rdatatable/data.table/wiki/Installation. After several years of many reports of installation problems on Mac, it's time to gingerly point out that there have been no similar problems on Windows or Linux.
**********

Attaching package: ‘data.table’

The following objects are masked from ‘package:dplyr’:

    between, first, last

The following object is masked from ‘package:purrr’:

    transpose

Loading required package: R6

Attaching package: ‘lightgbm’

The following object is masked from ‘package:plotly’:

    slice

The following objects are masked from ‘package:xgboost’:

    getinfo, setinfo, slice

The following object is masked from ‘package:dplyr’:

    slice


Attaching package: ‘kableExtra’

The following object is masked from ‘package:dplyr’:

    group_rows

Show in New Window
── Data Summary ────────────────────────
                           Values    
Name                       Piped data
Number of rows             307511    
Number of columns          122       
_______________________              
Column type frequency:               
  character                16        
  numeric                  106       
________________________             
Group variables            None      

── Variable type: character ─────────────────────────
   skim_variable              n_missing complete_rate
 1 NAME_CONTRACT_TYPE                 0         1    
 2 CODE_GENDER                        0         1    
 3 FLAG_OWN_CAR                       0         1    
 4 FLAG_OWN_REALTY                    0         1    
 5 NAME_TYPE_SUITE                 1292         0.996
 6 NAME_INCOME_TYPE                   0         1    
 7 NAME_EDUCATION_TYPE                0         1    
 8 NAME_FAMILY_STATUS                 0         1    
 9 NAME_HOUSING_TYPE                  0         1    
10 OCCUPATION_TYPE                96391         0.687
11 WEEKDAY_APPR_PROCESS_START         0         1    
12 ORGANIZATION_TYPE                  0         1    
13 FONDKAPREMONT_MODE            210295         0.316
14 HOUSETYPE_MODE                154297         0.498
15 WALLSMATERIAL_MODE            156341         0.492
16 EMERGENCYSTATE_MODE           145755         0.526
     min   max empty n_unique whitespace
 1    10    15     0        2          0
 2     1     3     0        3          0
 3     1     1     0        2          0
 4     1     1     0        2          0
 5     6    15     0        7          0
 6     7    20     0        8          0
 7    15    29     0        5          0
 8     5    20     0        6          0
 9    12    19     0        6          0
10     7    21     0       18          0
11     6     9     0        7          0
12     3    22     0       58          0
13    13    21     0        4          0
14    14    16     0        3          0
15     5    12     0        7          0
16     2     3     0        2          0

── Variable type: numeric ───────────────────────────
    skim_variable                n_missing
  1 SK_ID_CURR                           0
  2 TARGET                               0
  3 CNT_CHILDREN                         0
  4 AMT_INCOME_TOTAL                     0
  5 AMT_CREDIT                           0
  6 AMT_ANNUITY                         12
  7 AMT_GOODS_PRICE                    278
  8 REGION_POPULATION_RELATIVE           0
  9 DAYS_BIRTH                           0
 10 DAYS_EMPLOYED                        0
 11 DAYS_REGISTRATION                    0
 12 DAYS_ID_PUBLISH                      0
 13 OWN_CAR_AGE                     202929
 14 FLAG_MOBIL                           0
 15 FLAG_EMP_PHONE                       0
 16 FLAG_WORK_PHONE                      0
 17 FLAG_CONT_MOBILE                     0
 18 FLAG_PHONE                           0
 19 FLAG_EMAIL                           0
 20 CNT_FAM_MEMBERS                      2
 21 REGION_RATING_CLIENT                 0
 22 REGION_RATING_CLIENT_W_CITY          0
 23 HOUR_APPR_PROCESS_START              0
 24 REG_REGION_NOT_LIVE_REGION           0
 25 REG_REGION_NOT_WORK_REGION           0
 26 LIVE_REGION_NOT_WORK_REGION          0
 27 REG_CITY_NOT_LIVE_CITY               0
 28 REG_CITY_NOT_WORK_CITY               0
 29 LIVE_CITY_NOT_WORK_CITY              0
 30 EXT_SOURCE_1                    173378
 31 EXT_SOURCE_2                       660
 32 EXT_SOURCE_3                     60965
 33 APARTMENTS_AVG                  156061
 34 BASEMENTAREA_AVG                179943
 35 YEARS_BEGINEXPLUATATION_AVG     150007
 36 YEARS_BUILD_AVG                 204488
 37 COMMONAREA_AVG                  214865
 38 ELEVATORS_AVG                   163891
 39 ENTRANCES_AVG                   154828
 40 FLOORSMAX_AVG                   153020
 41 FLOORSMIN_AVG                   208642
 42 LANDAREA_AVG                    182590
 43 LIVINGAPARTMENTS_AVG            210199
 44 LIVINGAREA_AVG                  154350
 45 NONLIVINGAPARTMENTS_AVG         213514
 46 NONLIVINGAREA_AVG               169682
 47 APARTMENTS_MODE                 156061
 48 BASEMENTAREA_MODE               179943
 49 YEARS_BEGINEXPLUATATION_MODE    150007
 50 YEARS_BUILD_MODE                204488
 51 COMMONAREA_MODE                 214865
 52 ELEVATORS_MODE                  163891
 53 ENTRANCES_MODE                  154828
 54 FLOORSMAX_MODE                  153020
 55 FLOORSMIN_MODE                  208642
 56 LANDAREA_MODE                   182590
 57 LIVINGAPARTMENTS_MODE           210199
 58 LIVINGAREA_MODE                 154350
 59 NONLIVINGAPARTMENTS_MODE        213514
 60 NONLIVINGAREA_MODE              169682
 61 APARTMENTS_MEDI                 156061
 62 BASEMENTAREA_MEDI               179943
 63 YEARS_BEGINEXPLUATATION_MEDI    150007
 64 YEARS_BUILD_MEDI                204488
 65 COMMONAREA_MEDI                 214865
 66 ELEVATORS_MEDI                  163891
 67 ENTRANCES_MEDI                  154828
 68 FLOORSMAX_MEDI                  153020
 69 FLOORSMIN_MEDI                  208642
 70 LANDAREA_MEDI                   182590
 71 LIVINGAPARTMENTS_MEDI           210199
 72 LIVINGAREA_MEDI                 154350
 73 NONLIVINGAPARTMENTS_MEDI        213514
 74 NONLIVINGAREA_MEDI              169682
 75 TOTALAREA_MODE                  148431
 76 OBS_30_CNT_SOCIAL_CIRCLE          1021
 77 DEF_30_CNT_SOCIAL_CIRCLE          1021
 78 OBS_60_CNT_SOCIAL_CIRCLE          1021
 79 DEF_60_CNT_SOCIAL_CIRCLE          1021
 80 DAYS_LAST_PHONE_CHANGE               1
 81 FLAG_DOCUMENT_2                      0
 82 FLAG_DOCUMENT_3                      0
 83 FLAG_DOCUMENT_4                      0
 84 FLAG_DOCUMENT_5                      0
 85 FLAG_DOCUMENT_6                      0
 86 FLAG_DOCUMENT_7                      0
 87 FLAG_DOCUMENT_8                      0
 88 FLAG_DOCUMENT_9                      0
 89 FLAG_DOCUMENT_10                     0
 90 FLAG_DOCUMENT_11                     0
 91 FLAG_DOCUMENT_12                     0
 92 FLAG_DOCUMENT_13                     0
 93 FLAG_DOCUMENT_14                     0
 94 FLAG_DOCUMENT_15                     0
 95 FLAG_DOCUMENT_16                     0
 96 FLAG_DOCUMENT_17                     0
 97 FLAG_DOCUMENT_18                     0
 98 FLAG_DOCUMENT_19                     0
 99 FLAG_DOCUMENT_20                     0
100 FLAG_DOCUMENT_21                     0
101 AMT_REQ_CREDIT_BUREAU_HOUR       41519
102 AMT_REQ_CREDIT_BUREAU_DAY        41519
103 AMT_REQ_CREDIT_BUREAU_WEEK       41519
104 AMT_REQ_CREDIT_BUREAU_MON        41519
105 AMT_REQ_CREDIT_BUREAU_QRT        41519
106 AMT_REQ_CREDIT_BUREAU_YEAR       41519
    complete_rate     mean           sd       p0
  1         1      2.78e+5 102790.       1.00e+5
  2         1      8.07e-2      0.272    0      
  3         1      4.17e-1      0.722    0      
  4         1      1.69e+5 237123.       2.56e+4
  5         1      5.99e+5 402491.       4.5 e+4
  6         1.00   2.71e+4  14494.       1.62e+3
  7         0.999  5.38e+5 369446.       4.05e+4
  8         1      2.09e-2      0.0138   2.9 e-4
  9         1     -1.60e+4   4364.      -2.52e+4
 10         1      6.38e+4 141276.      -1.79e+4
 11         1     -4.99e+3   3523.      -2.47e+4
 12         1     -2.99e+3   1509.      -7.20e+3
 13         0.340  1.21e+1     11.9      0      
 14         1      1.00e+0      0.00180  0      
 15         1      8.20e-1      0.384    0      
 16         1      1.99e-1      0.400    0      
 17         1      9.98e-1      0.0432   0      
 18         1      2.81e-1      0.450    0      
 19         1      5.67e-2      0.231    0      
 20         1.00   2.15e+0      0.911    1   e+0
 21         1      2.05e+0      0.509    1   e+0
 22         1      2.03e+0      0.503    1   e+0
 23         1      1.21e+1      3.27     0      
 24         1      1.51e-2      0.122    0      
 25         1      5.08e-2      0.220    0      
 26         1      4.07e-2      0.197    0      
 27         1      7.82e-2      0.268    0      
 28         1      2.30e-1      0.421    0      
 29         1      1.80e-1      0.384    0      
 30         0.436  5.02e-1      0.211    1.46e-2
 31         0.998  5.14e-1      0.191    8.17e-8
 32         0.802  5.11e-1      0.195    5.27e-4
 33         0.493  1.17e-1      0.108    0      
 34         0.415  8.84e-2      0.0824   0      
 35         0.512  9.78e-1      0.0592   0      
 36         0.335  7.52e-1      0.113    0      
 37         0.301  4.46e-2      0.0760   0      
 38         0.467  7.89e-2      0.135    0      
 39         0.497  1.50e-1      0.100    0      
 40         0.502  2.26e-1      0.145    0      
 41         0.322  2.32e-1      0.161    0      
 42         0.406  6.63e-2      0.0812   0      
 43         0.316  1.01e-1      0.0926   0      
 44         0.498  1.07e-1      0.111    0      
 45         0.306  8.81e-3      0.0477   0      
 46         0.448  2.84e-2      0.0695   0      
 47         0.493  1.14e-1      0.108    0      
 48         0.415  8.75e-2      0.0843   0      
 49         0.512  9.77e-1      0.0646   0      
 50         0.335  7.60e-1      0.110    0      
 51         0.301  4.26e-2      0.0744   0      
 52         0.467  7.45e-2      0.132    0      
 53         0.497  1.45e-1      0.101    0      
 54         0.502  2.22e-1      0.144    0      
 55         0.322  2.28e-1      0.161    0      
 56         0.406  6.50e-2      0.0818   0      
 57         0.316  1.06e-1      0.0979   0      
 58         0.498  1.06e-1      0.112    0      
 59         0.306  8.08e-3      0.0463   0      
 60         0.448  2.70e-2      0.0703   0      
 61         0.493  1.18e-1      0.109    0      
 62         0.415  8.80e-2      0.0822   0      
 63         0.512  9.78e-1      0.0599   0      
 64         0.335  7.56e-1      0.112    0      
 65         0.301  4.46e-2      0.0761   0      
 66         0.467  7.81e-2      0.134    0      
 67         0.497  1.49e-1      0.100    0      
 68         0.502  2.26e-1      0.145    0      
 69         0.322  2.32e-1      0.162    0      
 70         0.406  6.72e-2      0.0822   0      
 71         0.316  1.02e-1      0.0936   0      
 72         0.498  1.09e-1      0.112    0      
 73         0.306  8.65e-3      0.0474   0      
 74         0.448  2.82e-2      0.0702   0      
 75         0.517  1.03e-1      0.107    0      
 76         0.997  1.42e+0      2.40     0      
 77         0.997  1.43e-1      0.447    0      
 78         0.997  1.41e+0      2.38     0      
 79         0.997  1.00e-1      0.362    0      
 80         1.00  -9.63e+2    827.      -4.29e+3
 81         1      4.23e-5      0.00650  0      
 82         1      7.10e-1      0.454    0      
 83         1      8.13e-5      0.00902  0      
 84         1      1.51e-2      0.122    0      
 85         1      8.81e-2      0.283    0      
 86         1      1.92e-4      0.0139   0      
 87         1      8.14e-2      0.273    0      
 88         1      3.90e-3      0.0623   0      
 89         1      2.28e-5      0.00477  0      
 90         1      3.91e-3      0.0624   0      
 91         1      6.50e-6      0.00255  0      
 92         1      3.53e-3      0.0593   0      
 93         1      2.94e-3      0.0541   0      
 94         1      1.21e-3      0.0348   0      
 95         1      9.93e-3      0.0991   0      
 96         1      2.67e-4      0.0163   0      
 97         1      8.13e-3      0.0898   0      
 98         1      5.95e-4      0.0244   0      
 99         1      5.07e-4      0.0225   0      
100         1      3.35e-4      0.0183   0      
101         0.865  6.40e-3      0.0838   0      
102         0.865  7.00e-3      0.111    0      
103         0.865  3.44e-2      0.205    0      
104         0.865  2.67e-1      0.916    0      
105         0.865  2.65e-1      0.794    0      
106         0.865  1.90e+0      1.87     0      
            p25         p50         p75     p100
  1 189146.     278202      367142.      4.56e+5
  2      0           0           0       1   e+0
  3      0           0           1       1.9 e+1
  4 112500      147150      202500       1.17e+8
  5 270000      513531      808650       4.05e+6
  6  16524       24903       34596       2.58e+5
  7 238500      450000      679500       4.05e+6
  8      0.0100      0.0188      0.0287  7.25e-2
  9 -19682      -15750      -12413      -7.49e+3
 10  -2760       -1213        -289       3.65e+5
 11  -7480.      -4504       -2010       0      
 12  -4299       -3254       -1720       0      
 13      5           9          15       9.1 e+1
 14      1           1           1       1   e+0
 15      1           1           1       1   e+0
 16      0           0           0       1   e+0
 17      1           1           1       1   e+0
 18      0           0           1       1   e+0
 19      0           0           0       1   e+0
 20      2           2           3       2   e+1
 21      2           2           2       3   e+0
 22      2           2           2       3   e+0
 23     10          12          14       2.3 e+1
 24      0           0           0       1   e+0
 25      0           0           0       1   e+0
 26      0           0           0       1   e+0
 27      0           0           0       1   e+0
 28      0           0           0       1   e+0
 29      0           0           0       1   e+0
 30      0.334       0.506       0.675   9.63e-1
 31      0.392       0.566       0.664   8.55e-1
 32      0.371       0.535       0.669   8.96e-1
 33      0.0577      0.0876      0.148   1   e+0
 34      0.0442      0.0763      0.112   1   e+0
 35      0.977       0.982       0.987   1   e+0
 36      0.687       0.755       0.823   1   e+0
 37      0.0078      0.0211      0.0515  1   e+0
 38      0           0           0.12    1   e+0
 39      0.069       0.138       0.207   1   e+0
 40      0.167       0.167       0.333   1   e+0
 41      0.0833      0.208       0.375   1   e+0
 42      0.0187      0.0481      0.0856  1   e+0
 43      0.0504      0.0756      0.121   1   e+0
 44      0.0453      0.0745      0.130   1   e+0
 45      0           0           0.0039  1   e+0
 46      0           0.0036      0.0277  1   e+0
 47      0.0525      0.084       0.144   1   e+0
 48      0.0407      0.0746      0.112   1   e+0
 49      0.977       0.982       0.987   1   e+0
 50      0.699       0.765       0.824   1   e+0
 51      0.0072      0.019       0.049   1   e+0
 52      0           0           0.121   1   e+0
 53      0.069       0.138       0.207   1   e+0
 54      0.167       0.167       0.333   1   e+0
 55      0.0833      0.208       0.375   1   e+0
 56      0.0166      0.0458      0.0841  1   e+0
 57      0.0542      0.0771      0.131   1   e+0
 58      0.0427      0.0731      0.125   1   e+0
 59      0           0           0.0039  1   e+0
 60      0           0.0011      0.0231  1   e+0
 61      0.0583      0.0864      0.149   1   e+0
 62      0.0437      0.0758      0.112   1   e+0
 63      0.977       0.982       0.987   1   e+0
 64      0.691       0.758       0.826   1   e+0
 65      0.0079      0.0208      0.0513  1   e+0
 66      0           0           0.12    1   e+0
 67      0.069       0.138       0.207   1   e+0
 68      0.167       0.167       0.333   1   e+0
 69      0.0833      0.208       0.375   1   e+0
 70      0.0187      0.0487      0.0868  1   e+0
 71      0.0513      0.0761      0.123   1   e+0
 72      0.0457      0.0749      0.130   1   e+0
 73      0           0           0.0039  1   e+0
 74      0           0.0031      0.0266  1   e+0
 75      0.0412      0.0688      0.128   1   e+0
 76      0           0           2       3.48e+2
 77      0           0           0       3.4 e+1
 78      0           0           2       3.44e+2
 79      0           0           0       2.4 e+1
 80  -1570        -757        -274       0      
 81      0           0           0       1   e+0
 82      0           1           1       1   e+0
 83      0           0           0       1   e+0
 84      0           0           0       1   e+0
 85      0           0           0       1   e+0
 86      0           0           0       1   e+0
 87      0           0           0       1   e+0
 88      0           0           0       1   e+0
 89      0           0           0       1   e+0
 90      0           0           0       1   e+0
 91      0           0           0       1   e+0
 92      0           0           0       1   e+0
 93      0           0           0       1   e+0
 94      0           0           0       1   e+0
 95      0           0           0       1   e+0
 96      0           0           0       1   e+0
 97      0           0           0       1   e+0
 98      0           0           0       1   e+0
 99      0           0           0       1   e+0
100      0           0           0       1   e+0
101      0           0           0       4   e+0
102      0           0           0       9   e+0
103      0           0           0       8   e+0
104      0           0           0       2.7 e+1
105      0           0           0       2.61e+2
106      0           1           3       2.5 e+1
    hist 
  1 ▇▇▇▇▇
  2 ▇▁▁▁▁
  3 ▇▁▁▁▁
  4 ▇▁▁▁▁
  5 ▇▂▁▁▁
  6 ▇▁▁▁▁
  7 ▇▂▁▁▁
  8 ▇▇▃▁▁
  9 ▃▆▇▇▅
 10 ▇▁▁▁▂
 11 ▁▁▂▅▇
 12 ▁▆▇▆▅
 13 ▇▁▁▁▁
 14 ▁▁▁▁▇
 15 ▂▁▁▁▇
 16 ▇▁▁▁▂
 17 ▁▁▁▁▇
 18 ▇▁▁▁▃
 19 ▇▁▁▁▁
 20 ▇▁▁▁▁
 21 ▁▁▇▁▂
 22 ▁▁▇▁▂
 23 ▁▃▇▆▁
 24 ▇▁▁▁▁
 25 ▇▁▁▁▁
 26 ▇▁▁▁▁
 27 ▇▁▁▁▁
 28 ▇▁▁▁▂
 29 ▇▁▁▁▂
 30 ▂▇▇▇▃
 31 ▂▂▃▇▃
 32 ▂▃▆▇▃
 33 ▇▁▁▁▁
 34 ▇▁▁▁▁
 35 ▁▁▁▁▇
 36 ▁▁▁▇▅
 37 ▇▁▁▁▁
 38 ▇▁▁▁▁
 39 ▇▃▁▁▁
 40 ▇▃▁▁▁
 41 ▅▇▁▁▁
 42 ▇▁▁▁▁
 43 ▇▁▁▁▁
 44 ▇▁▁▁▁
 45 ▇▁▁▁▁
 46 ▇▁▁▁▁
 47 ▇▁▁▁▁
 48 ▇▁▁▁▁
 49 ▁▁▁▁▇
 50 ▁▁▁▇▅
 51 ▇▁▁▁▁
 52 ▇▁▁▁▁
 53 ▇▂▁▁▁
 54 ▇▃▁▁▁
 55 ▅▇▁▁▁
 56 ▇▁▁▁▁
 57 ▇▁▁▁▁
 58 ▇▁▁▁▁
 59 ▇▁▁▁▁
 60 ▇▁▁▁▁
 61 ▇▁▁▁▁
 62 ▇▁▁▁▁
 63 ▁▁▁▁▇
 64 ▁▁▁▇▅
 65 ▇▁▁▁▁
 66 ▇▁▁▁▁
 67 ▇▃▁▁▁
 68 ▇▃▁▁▁
 69 ▅▇▁▁▁
 70 ▇▁▁▁▁
 71 ▇▁▁▁▁
 72 ▇▁▁▁▁
 73 ▇▁▁▁▁
 74 ▇▁▁▁▁
 75 ▇▁▁▁▁
 76 ▇▁▁▁▁
 77 ▇▁▁▁▁
 78 ▇▁▁▁▁
 79 ▇▁▁▁▁
 80 ▁▁▂▃▇
 81 ▇▁▁▁▁
 82 ▃▁▁▁▇
 83 ▇▁▁▁▁
 84 ▇▁▁▁▁
 85 ▇▁▁▁▁
 86 ▇▁▁▁▁
 87 ▇▁▁▁▁
 88 ▇▁▁▁▁
 89 ▇▁▁▁▁
 90 ▇▁▁▁▁
 91 ▇▁▁▁▁
 92 ▇▁▁▁▁
 93 ▇▁▁▁▁
 94 ▇▁▁▁▁
 95 ▇▁▁▁▁
 96 ▇▁▁▁▁
 97 ▇▁▁▁▁
 98 ▇▁▁▁▁
 99 ▇▁▁▁▁
100 ▇▁▁▁▁
101 ▇▁▁▁▁
102 ▇▁▁▁▁
103 ▇▁▁▁▁
104 ▇▁▁▁▁
105 ▇▁▁▁▁
106 ▇▁▁▁▁
Show in New Window
[1] 48744   121
Show in New Window
|--------------------------------------------------|
|==================================================|
|--------------------------------------------------|
|==================================================|
[1] 1716428      17
── Data Summary ────────────────────────
                           Values    
Name                       Piped data
Number of rows             1716428   
Number of columns          17        
_______________________              
Column type frequency:               
  character                3         
  numeric                  14        
________________________             
Group variables            None      

── Variable type: character ─────────────────────────
  skim_variable   n_missing complete_rate   min   max
1 CREDIT_ACTIVE           0             1     4     8
2 CREDIT_CURRENCY         0             1    10    10
3 CREDIT_TYPE             0             1     8    44
  empty n_unique whitespace
1     0        4          0
2     0        4          0
3     0       15          0

── Variable type: numeric ───────────────────────────
   skim_variable          n_missing complete_rate
 1 SK_ID_CURR                     0         1    
 2 SK_ID_BUREAU                   0         1    
 3 DAYS_CREDIT                    0         1    
 4 CREDIT_DAY_OVERDUE             0         1    
 5 DAYS_CREDIT_ENDDATE       105553         0.939
 6 DAYS_ENDDATE_FACT         633653         0.631
 7 AMT_CREDIT_MAX_OVERDUE   1124488         0.345
 8 CNT_CREDIT_PROLONG             0         1    
 9 AMT_CREDIT_SUM                13         1.00 
10 AMT_CREDIT_SUM_DEBT       257669         0.850
11 AMT_CREDIT_SUM_LIMIT      591780         0.655
12 AMT_CREDIT_SUM_OVERDUE         0         1    
13 DAYS_CREDIT_UPDATE             0         1    
14 AMT_ANNUITY              1226791         0.285
            mean           sd        p0      p25
 1  278215.       102939.       100001   188867.
 2 5924434.       532266.      5000000  5463954.
 3   -1142.          795.        -2922    -1666 
 4       0.818        36.5           0        0 
 5     511.         4994.       -42060    -1138 
 6   -1017.          714.       -42023    -1489 
 7    3825.       206032.            0        0 
 8       0.00641       0.0962        0        0 
 9  354995.      1149811.            0    51300 
10  137085.       677401.     -4705600.       0 
11    6230.        45032.      -586406.       0 
12      37.9        5938.            0        0 
13    -594.          721.       -41947     -908 
14   15713.       325827.            0        0 
        p50      p75       p100 hist 
 1  278055   367426     456255  ▇▇▇▇▇
 2 5926304. 6385681.   6843457  ▇▇▇▇▇
 3    -987     -474          0  ▃▃▅▇▇
 4       0        0       2792  ▇▁▁▁▁
 5    -330      474      31199  ▁▁▇▁▁
 6    -897     -425          0  ▁▁▁▁▇
 7       0        0  115987185  ▇▁▁▁▁
 8       0        0          9  ▇▁▁▁▁
 9  125518.  315000  585000000  ▇▁▁▁▁
10       0    40154. 170100000  ▇▁▁▁▁
11       0        0    4705600. ▇▁▁▁▁
12       0        0    3756681  ▇▁▁▁▁
13    -395      -33        372  ▁▁▁▁▇
14       0    13500  118453424. ▇▁▁▁▁
Show in New Window
── Data Summary ────────────────────────
                           Values    
Name                       Piped data
Number of rows             1670214   
Number of columns          37        
_______________________              
Column type frequency:               
  character                16        
  numeric                  21        
________________________             
Group variables            None      

── Variable type: character ─────────────────────────
   skim_variable               n_missing
 1 NAME_CONTRACT_TYPE                  0
 2 WEEKDAY_APPR_PROCESS_START          0
 3 FLAG_LAST_APPL_PER_CONTRACT         0
 4 NAME_CASH_LOAN_PURPOSE              0
 5 NAME_CONTRACT_STATUS                0
 6 NAME_PAYMENT_TYPE                   0
 7 CODE_REJECT_REASON                  0
 8 NAME_TYPE_SUITE                820405
 9 NAME_CLIENT_TYPE                    0
10 NAME_GOODS_CATEGORY                 0
11 NAME_PORTFOLIO                      0
12 NAME_PRODUCT_TYPE                   0
13 CHANNEL_TYPE                        0
14 NAME_SELLER_INDUSTRY                0
15 NAME_YIELD_GROUP                    0
16 PRODUCT_COMBINATION               346
   complete_rate   min   max empty n_unique
 1         1         3    15     0        4
 2         1         6     9     0        7
 3         1         1     1     0        2
 4         1         3    32     0       25
 5         1         7    12     0        4
 6         1         3    41     0        4
 7         1         2     6     0        9
 8         0.509     6    15     0        7
 9         1         3     9     0        4
10         1         3    24     0       28
11         1         3     5     0        5
12         1         3     7     0        3
13         1         5    26     0        8
14         1         3    20     0       11
15         1         3    10     0        5
16         1.00      4    30     0       17
   whitespace
 1          0
 2          0
 3          0
 4          0
 5          0
 6          0
 7          0
 8          0
 9          0
10          0
11          0
12          0
13          0
14          0
15          0
16          0

── Variable type: numeric ───────────────────────────
   skim_variable             n_missing complete_rate
 1 SK_ID_PREV                        0       1      
 2 SK_ID_CURR                        0       1      
 3 AMT_ANNUITY                  372235       0.777  
 4 AMT_APPLICATION                   0       1      
 5 AMT_CREDIT                        1       1.00   
 6 AMT_DOWN_PAYMENT             895844       0.464  
 7 AMT_GOODS_PRICE              385515       0.769  
 8 HOUR_APPR_PROCESS_START           0       1      
 9 NFLAG_LAST_APPL_IN_DAY            0       1      
10 RATE_DOWN_PAYMENT            895844       0.464  
11 RATE_INTEREST_PRIMARY       1664263       0.00356
12 RATE_INTEREST_PRIVILEGED    1664263       0.00356
13 DAYS_DECISION                     0       1      
14 SELLERPLACE_AREA                  0       1      
15 CNT_PAYMENT                  372230       0.777  
16 DAYS_FIRST_DRAWING           673065       0.597  
17 DAYS_FIRST_DUE               673065       0.597  
18 DAYS_LAST_DUE_1ST_VERSION    673065       0.597  
19 DAYS_LAST_DUE                673065       0.597  
20 DAYS_TERMINATION             673065       0.597  
21 NFLAG_INSURED_ON_APPROVAL    673065       0.597  
           mean          sd       p0         p25
 1 1923089.     532598.      1.00e+6 1461857.   
 2  278357.     102815.      1.00e+5  189329    
 3   15955.      14782.      0          6322.   
 4  175234.     292780.      0         18720    
 5  196114.     318575.      0         24160.   
 6    6697.      20921.     -9   e-1       0    
 7  227847.     315397.      0         50841    
 8      12.5         3.33    0            10    
 9       0.996       0.0593  0             1    
10       0.0796      0.108  -1.50e-5       0    
11       0.188       0.0877  3.48e-2       0.161
12       0.774       0.101   3.73e-1       0.716
13    -881.        779.     -2.92e+3   -1300    
14     314.       7127.     -1   e+0      -1    
15      16.1        14.6     0             6    
16  342210.      88916.     -2.92e+3  365243    
17   13826.      72445.     -2.89e+3   -1628    
18   33768.     106857.     -2.80e+3   -1242    
19   76582.     149647.     -2.89e+3   -1314    
20   81992.     153304.     -2.87e+3   -1270    
21       0.333       0.471   0             0    
            p50         p75     p100 hist 
 1 1923110.     2384280.    2845382  ▇▇▇▇▇
 2  278714.      367514      456255  ▇▇▇▇▇
 3   11250        20658.     418058. ▇▁▁▁▁
 4   71046       180360     6905160  ▇▁▁▁▁
 5   80541       216418.    6905160  ▇▁▁▁▁
 6    1638         7740     3060045  ▇▁▁▁▁
 7  112320       234000     6905160  ▇▁▁▁▁
 8      12           15          23  ▁▃▇▆▁
 9       1            1           1  ▁▁▁▁▇
10       0.0516       0.109       1  ▇▁▁▁▁
11       0.189        0.193       1  ▇▁▁▁▁
12       0.835        0.853       1  ▁▁▅▇▁
13    -581         -280          -1  ▂▁▂▃▇
14       3           82     4000000  ▇▁▁▁▁
15      12           24          84  ▇▂▁▁▁
16  365243       365243      365243  ▁▁▁▁▇
17    -831         -411      365243  ▇▁▁▁▁
18    -361          129      365243  ▇▁▁▁▁
19    -537          -74      365243  ▇▁▁▁▂
20    -499          -44      365243  ▇▁▁▁▂
21       0            1           1  ▇▁▁▁▃
Show in New Window
── Data Summary ────────────────────────
                           Values    
Name                       Piped data
Number of rows             27299925  
Number of columns          3         
_______________________              
Column type frequency:               
  character                1         
  numeric                  2         
________________________             
Group variables            None      

── Variable type: character ────────────────────────
  skim_variable n_missing complete_rate   min   max
1 STATUS                0             1     1     1
  empty n_unique whitespace
1     0        8          0

── Variable type: numeric ──────────────────────────
  skim_variable  n_missing complete_rate      mean
1 SK_ID_BUREAU           0             1 6036297. 
2 MONTHS_BALANCE         0             1     -30.7
        sd      p0     p25     p50     p75    p100
1 492349.  5001709 5730933 6070821 6431951 6842888
2     23.9     -96     -46     -25     -11       0
  hist 
1 ▃▃▇▇▆
2 ▁▂▃▅▇
Show in New Window
|--------------------------------------------------|
|==================================================|
Show in New Window
|--------------------------------------------------|
|==================================================|
Show in New Window
|--------------------------------------------------|
|==================================================|
Show in New Window
── Data Summary ────────────────────────
                           Values    
Name                       Piped data
Number of rows             48744     
Number of columns          2         
_______________________              
Column type frequency:               
  numeric                  2         
________________________             
Group variables            None      

── Variable type: numeric ──────────────────────────
  skim_variable n_missing complete_rate     mean
1 SK_ID_CURR            0             1 277797. 
2 TARGET                0             1      0.5
       sd       p0      p25      p50      p75
1 103170. 100001   188558.  277549   367556. 
2      0       0.5      0.5      0.5      0.5
      p100 hist 
1 456250   ▇▇▇▇▇
2      0.5 ▁▁▇▁▁
Show in New Window

100002 100003 100004 100006 100007 100008 100009 
     1      1      1      1      1      1      1 
100010 100011 100012 
     1      1      1 
Show in New Window

5001709 5001710 5001711 5001712 5001713 5001714 
     97      83       4      19      22      15 
5001715 5001716 5001717 5001718 
     60      86      22      39 
Show in New Window

100002 100003 100004 100006 100007 100008 100009 
     1      1      1      1      1      1      1 
100010 100011 100012 100014 100015 100016 100017 
     1      1      1      1      1      1      1 
100018 100019 100020 100021 100022 100023 100024 
     1      1      1      1      1      1      1 
100025 100026 100027 100029 100030 100031 100032 
     1      1      1      1      1      1      1 
100033 100034 100035 100036 100037 100039 100040 
     1      1      1      1      1      1      1 
100041 100043 100044 100045 100046 100047 100048 
     1      1      1      1      1      1      1 
100049 100050 100051 100052 100053 100054 100055 
     1      1      1      1      1      1      1 
100056 100058 100059 100060 100061 100062 100063 
     1      1      1      1      1      1      1 
100064 100068 100069 100070 100071 100072 100073 
     1      1      1      1      1      1      1 
100075 100076 100077 100078 100079 100080 100081 
     1      1      1      1      1      1      1 
100082 100083 100084 100085 100086 100087 100088 
     1      1      1      1      1      1      1 
100089 100093 100094 100095 100096 100097 100098 
     1      1      1      1      1      1      1 
100099 100100 100101 100102 100103 100104 100105 
     1      1      1      1      1      1      1 
100108 100110 100111 100112 100113 100114 100115 
     1      1      1      1      1      1      1 
100116 100118 100119 100120 100121 100122 100123 
     1      1      1      1      1      1      1 
100124 100125 100126 100127 100129 100130 100131 
     1      1      1      1      1      1      1 
100132 100133 100134 100135 100136 100137 100138 
     1      1      1      1      1      1      1 
100139 100140 100142 100143 100144 100145 100146 
     1      1      1      1      1      1      1 
100147 100148 100149 100151 100152 100153 100154 
     1      1      1      1      1      1      1 
100155 100156 100157 100158 100159 100160 100161 
     1      1      1      1      1      1      1 
100162 100163 100164 100165 100166 100167 100173 
     1      1      1      1      1      1      1 
100174 100175 100176 100177 100178 100179 100180 
     1      1      1      1      1      1      1 
100181 100182 100183 100185 100186 100188 100189 
     1      1      1      1      1      1      1 
100190 100191 100192 100193 100194 100195 100196 
     1      1      1      1      1      1      1 
100197 100198 100199 100200 100201 100202 100203 
     1      1      1      1      1      1      1 
100204 100205 100206 100207 100208 100209 100210 
     1      1      1      1      1      1      1 
100211 100213 100214 100215 100216 100217 100218 
     1      1      1      1      1      1      1 
100219 100220 100221 100224 100225 100226 100227 
     1      1      1      1      1      1      1 
100228 100229 100230 100231 100233 100234 100235 
     1      1      1      1      1      1      1 
100236 100237 100238 100239 100240 100242 100243 
     1      1      1      1      1      1      1 
100244 100246 100247 100248 100249 100250 100251 
     1      1      1      1      1      1      1 
100252 100254 100255 100257 100258 100259 100260 
     1      1      1      1      1      1      1 
100261 100262 100263 100264 100265 100266 100267 
     1      1      1      1      1      1      1 
100268 100269 100270 100272 100273 100274 100275 
     1      1      1      1      1      1      1 
100276 100277 100279 100281 100282 100283 100284 
     1      1      1      1      1      1      1 
100285 100286 100287 100288 100289 100290 100291 
     1      1      1      1      1      1      1 
100292 100293 100294 100295 100296 100297 100298 
     1      1      1      1      1      1      1 
100299 100300 100301 100302 100303 100304 100305 
     1      1      1      1      1      1      1 
100307 100308 100309 100310 100313 100314 100315 
     1      1      1      1      1      1      1 
100316 100317 100318 100319 100320 100321 100322 
     1      1      1      1      1      1      1 
100323 100324 100325 100326 100327 100328 100329 
     1      1      1      1      1      1      1 
100332 100333 100334 100335 100336 100337 100338 
     1      1      1      1      1      1      1 
100339 100340 100341 100342 100343 100344 100345 
     1      1      1      1      1      1      1 
100346 100347 100348 100349 100350 100351 100353 
     1      1      1      1      1      1      1 
100354 100355 100356 100357 100359 100360 100361 
     1      1      1      1      1      1      1 
100362 100363 100364 100365 100366 100368 100369 
     1      1      1      1      1      1      1 
100370 100371 100372 100373 100374 100375 100376 
     1      1      1      1      1      1      1 
100377 100378 100379 100380 100381 100383 100387 
     1      1      1      1      1      1      1 
100388 100389 100390 100391 100392 100393 100394 
     1      1      1      1      1      1      1 
100395 100396 100397 100398 100400 100401 100402 
     1      1      1      1      1      1      1 
100403 100405 100406 100407 100408 100409 100410 
     1      1      1      1      1      1      1 
100411 100412 100413 100414 100415 100417 100418 
     1      1      1      1      1      1      1 
100419 100420 100421 100423 100424 100425 100427 
     1      1      1      1      1      1      1 
100428 100429 100430 100431 100432 100433 100434 
     1      1      1      1      1      1      1 
100435 100436 100437 100439 100440 100441 100442 
     1      1      1      1      1      1      1 
100443 100448 100449 100451 100452 100453 100454 
     1      1      1      1      1      1      1 
100455 100456 100457 100458 100459 100460 100461 
     1      1      1      1      1      1      1 
100462 100463 100464 100465 100467 100468 100469 
     1      1      1      1      1      1      1 
100470 100471 100472 100473 100474 100475 100476 
     1      1      1      1      1      1      1 
100477 100478 100479 100480 100481 100482 100485 
     1      1      1      1      1      1      1 
100486 100487 100488 100489 100490 100491 100492 
     1      1      1      1      1      1      1 
100493 100495 100496 100497 100498 100499 100500 
     1      1      1      1      1      1      1 
100501 100502 100503 100504 100505 100506 100507 
     1      1      1      1      1      1      1 
100508 100509 100511 100513 100514 100515 100516 
     1      1      1      1      1      1      1 
100518 100519 100520 100521 100522 100523 100524 
     1      1      1      1      1      1      1 
100525 100526 100527 100528 100529 100530 100531 
     1      1      1      1      1      1      1 
100532 100533 100534 100535 100536 100537 100538 
     1      1      1      1      1      1      1 
100539 100540 100541 100542 100543 100544 100545 
     1      1      1      1      1      1      1 
100546 100547 100549 100550 100554 100555 100556 
     1      1      1      1      1      1      1 
100557 100558 100559 100560 100562 100563 100564 
     1      1      1      1      1      1      1 
100565 100566 100567 100570 100571 100572 100573 
     1      1      1      1      1      1      1 
100574 100575 100576 100577 100578 100579 100580 
     1      1      1      1      1      1      1 
100581 100582 100583 100584 100585 100586 100587 
     1      1      1      1      1      1      1 
100588 100589 100590 100593 100594 100595 100596 
     1      1      1      1      1      1      1 
100597 100598 100599 100600 100601 100603 100604 
     1      1      1      1      1      1      1 
100605 100606 100608 100609 100610 100611 100612 
     1      1      1      1      1      1      1 
100614 100615 100616 100619 100620 100621 100623 
     1      1      1      1      1      1      1 
100624 100626 100627 100628 100629 100630 100631 
     1      1      1      1      1      1      1 
100632 100633 100634 100635 100636 100637 100638 
     1      1      1      1      1      1      1 
100639 100640 100641 100642 100643 100644 100645 
     1      1      1      1      1      1      1 
100646 100647 100648 100649 100650 100651 100652 
     1      1      1      1      1      1      1 
100653 100654 100655 100656 100657 100658 100659 
     1      1      1      1      1      1      1 
100660 100661 100662 100663 100664 100665 100666 
     1      1      1      1      1      1      1 
100667 100668 100669 100670 100671 100672 100673 
     1      1      1      1      1      1      1 
100674 100675 100676 100678 100679 100680 100681 
     1      1      1      1      1      1      1 
100682 100683 100684 100685 100686 100687 100688 
     1      1      1      1      1      1      1 
100689 100690 100691 100692 100693 100694 100695 
     1      1      1      1      1      1      1 
100696 100697 100698 100700 100701 100703 100704 
     1      1      1      1      1      1      1 
100705 100706 100707 100708 100709 100710 100712 
     1      1      1      1      1      1      1 
100713 100714 100715 100716 100717 100718 100719 
     1      1      1      1      1      1      1 
100720 100721 100722 100723 100724 100725 100726 
     1      1      1      1      1      1      1 
100727 100728 100730 100731 100732 100733 100734 
     1      1      1      1      1      1      1 
100735 100736 100737 100738 100739 100741 100742 
     1      1      1      1      1      1      1 
100743 100746 100748 100749 100750 100755 100756 
     1      1      1      1      1      1      1 
100757 100758 100759 100761 100764 100766 100767 
     1      1      1      1      1      1      1 
100768 100769 100771 100773 100774 100775 100776 
     1      1      1      1      1      1      1 
100778 100779 100780 100781 100782 100783 100784 
     1      1      1      1      1      1      1 
100785 100786 100787 100788 100789 100790 100793 
     1      1      1      1      1      1      1 
100794 100795 100796 100798 100799 100800 100801 
     1      1      1      1      1      1      1 
100802 100803 100804 100805 100806 100807 100808 
     1      1      1      1      1      1      1 
100809 100810 100811 100812 100813 100814 100815 
     1      1      1      1      1      1      1 
100816 100817 100818 100819 100820 100821 100822 
     1      1      1      1      1      1      1 
100824 100825 100827 100828 100829 100831 100832 
     1      1      1      1      1      1      1 
100833 100834 100835 100837 100838 100839 100840 
     1      1      1      1      1      1      1 
100841 100842 100843 100844 100845 100846 100847 
     1      1      1      1      1      1      1 
100848 100849 100850 100851 100852 100853 100854 
     1      1      1      1      1      1      1 
100855 100856 100857 100858 100859 100860 100861 
     1      1      1      1      1      1      1 
100862 100863 100864 100865 100866 100867 100868 
     1      1      1      1      1      1      1 
100869 100870 100871 100873 100874 100875 100876 
     1      1      1      1      1      1      1 
100877 100878 100879 100880 100881 100882 100883 
     1      1      1      1      1      1      1 
100884 100885 100886 100887 100888 100889 100890 
     1      1      1      1      1      1      1 
100891 100892 100893 100894 100895 100896 100897 
     1      1      1      1      1      1      1 
100898 100899 100900 100901 100902 100903 100904 
     1      1      1      1      1      1      1 
100905 100906 100907 100908 100909 100911 100912 
     1      1      1      1      1      1      1 
100914 100915 100916 100917 100919 100920 100921 
     1      1      1      1      1      1      1 
100922 100923 100924 100925 100926 100927 100928 
     1      1      1      1      1      1      1 
100929 100930 100932 100933 100934 100935 100936 
     1      1      1      1      1      1      1 
100937 100938 100939 100940 100941 100942 100943 
     1      1      1      1      1      1      1 
100944 100945 100946 100947 100948 100949 100950 
     1      1      1      1      1      1      1 
100951 100954 100955 100956 100957 100958 100959 
     1      1      1      1      1      1      1 
100960 100961 100962 100963 100964 100966 100967 
     1      1      1      1      1      1      1 
100968 100969 100971 100972 100973 100974 100975 
     1      1      1      1      1      1      1 
100976 100977 100978 100979 100980 100981 100985 
     1      1      1      1      1      1      1 
100986 100988 100989 100990 100991 100992 100993 
     1      1      1      1      1      1      1 
100994 100995 100996 100999 101000 101001 101003 
     1      1      1      1      1      1      1 
101004 101006 101007 101009 101010 101011 101012 
     1      1      1      1      1      1      1 
101013 101014 101015 101016 101017 101018 101019 
     1      1      1      1      1      1      1 
101022 101023 101027 101028 101029 101030 101032 
     1      1      1      1      1      1      1 
101033 101034 101035 101036 101037 101038 101039 
     1      1      1      1      1      1      1 
101040 101042 101043 101044 101045 101046 101047 
     1      1      1      1      1      1      1 
101048 101049 101050 101052 101053 101054 101058 
     1      1      1      1      1      1      1 
101059 101060 101061 101062 101063 101065 101066 
     1      1      1      1      1      1      1 
101067 101068 101069 101070 101071 101072 101073 
     1      1      1      1      1      1      1 
101074 101075 101076 101077 101078 101080 101081 
     1      1      1      1      1      1      1 
101082 101083 101084 101085 101086 101088 101089 
     1      1      1      1      1      1      1 
101091 101093 101094 101095 101096 101098 101100 
     1      1      1      1      1      1      1 
101101 101102 101103 101104 101105 101106 101108 
     1      1      1      1      1      1      1 
101109 101110 101111 101112 101113 101114 101115 
     1      1      1      1      1      1      1 
101116 101117 101119 101120 101121 101122 101123 
     1      1      1      1      1      1      1 
101124 101127 101129 101130 101131 101132 101133 
     1      1      1      1      1      1      1 
101134 101135 101137 101138 101139 101141 101142 
     1      1      1      1      1      1      1 
101143 101144 101145 101146 101147 101148 101150 
     1      1      1      1      1      1      1 
101151 101152 101153 101154 101155 101156 
     1      1      1      1      1      1 
 [ reached getOption("max.print") -- omitted 306511 entries ]

---
title: "day_1_data_import"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction 

## 대회 개요
- 

## 데이터 파일 구조
- 데이터 파일 구조는 크게 2가지로 나뉠 수 있다. 

![](img/map.png)

- Credit Bureau 파일 구조와 Home Credit 파일 구조로 분리할 수 있음. 
- Bureau (External File)
- Home Credit (Internal File)
  + 현재 Home Credit File (Application train/test)
  + 이전 Home Credit File (Other's)
  
## 평가 지표
- 제출한 파일은 예측 확률과 기존 관측 대상 사이의 [ROC Curve](http://en.wikipedia.org/wiki/Receiver_operating_characteristic)로 평가 한다. 

# 분석 준비

## 패키지 불러오기
- 주요 패키지를 불러오도록 한다. 

```{r, message=FALSE, warning=FALSE}
library(tidyverse)
library(skimr)
library(GGally)
library(plotly)
library(viridis)
library(caret)
library(DT)
library(data.table)
library(lightgbm)
library(kableExtra)
```

## 데이터 불러오기
- 이번에는 `fread()`를 활용하여 데이터를 불러도록 한다. 

```{r}
na_strings = c("NA", "NaN", "?", "")
train = fread('data/home-credit-default-risk/application_train.csv', 
              stringsAsFactors = FALSE, 
              data.table = FALSE, na.strings = na_strings)

train %>% skim()
```

```{r}
test = fread('data/home-credit-default-risk/application_test.csv', 
              stringsAsFactors = FALSE, 
              data.table = FALSE, na.strings = na_strings)

dim(test)
```
```{r}
bureau = fread('data/home-credit-default-risk/bureau.csv', 
              stringsAsFactors = FALSE, 
              data.table = FALSE, na.strings = na_strings)

dim(bureau)
bureau %>% skim()
```
```{r}
prev = fread('data/home-credit-default-risk/previous_application.csv', 
              stringsAsFactors = FALSE, 
              data.table = FALSE, na.strings = na_strings)

dim(prev)
prev %>% skim()
```

# 주요 변수 시각화
## Target
- 우선 Target Variable의 데이터를 확인해본다. 
- 먼저 데이터 요약을 해보자. 
```{r}
train %>% 
  group_by(TARGET) %>%
  summarise(Count = n())
```

- 전체적인 비율을 구해본다. 

```{r}
# fillColor = "#FFA07A"
# fillColor2 = "#F1C40F"
# fillColorLightCoral = "#F08080"

train %>% 
  group_by(TARGET) %>%
  summarise(Count = n() / nrow(train) * 100) %>% 
  arrange(desc(Count)) %>% 
  ungroup() %>% 
  mutate(TARGET = reorder(TARGET, Count)) %>% 
  ggplot(aes(x = TARGET, y = Count)) + 
    geom_bar(stat = "identity", fill = "#F1C40F") + 
    geom_text(aes(x = TARGET, y = 1, label = paste0(round(Count, 2), " %")), 
              hjust = 0, vjust = .5, size = 3.5, colour = "white", fontface = "bold") + 
    coord_flip() + 
    labs(x = "TARGET", 
         y = "Percentage (%)", 
         title = "Percentage of Target Data (N = 307,511)", 
         subtitle = "0 - Capable to Repay Debt; 1 - Not Capable to Repay Debt", 
         caption = "Created by McBert") + 
    theme_minimal()
```

## Gender

- 이번에는 Gender의 숫자를 구해본다. 

```{r}
train %>% 
  group_by(CODE_GENDER) %>%
  summarise(Count = n())
```

- 이번에는 TARGET ~ TARGET 데이터를 요약해본다. 
```{r}
train %>% 
  group_by(CODE_GENDER, TARGET) %>%
  summarise(Count = n())
```


- 이번에는 시각화를 해본다. 
```{r}
train %>% 
  group_by(CODE_GENDER, TARGET) %>%
  summarise(Count = n() / nrow(train) * 100) %>% 
  arrange(desc(Count)) %>% 
  ungroup() %>% 
  mutate(CODE_GENDER = reorder(CODE_GENDER, Count), 
         TARGET = as.factor(TARGET)) %>% 
  ggplot(aes(x = CODE_GENDER, y = Count, fill = TARGET)) + 
    geom_bar(stat = "identity", position = position_dodge(width = 1)) + 
    geom_text(aes(x = CODE_GENDER, y = Count + 2, label = paste0(round(Count, 2), " %"), group = TARGET), 
              position = position_dodge(width = 1), size = 3.5, colour = "black", fontface = "bold") + 
    labs(x = "Gender", 
         y = "Percentage (%)", 
         title = "Percentage of Target ~ Gender Data (N = 307,511)", 
         subtitle = "0 - Capable to Repay Debt; 1 - Not Capable to Repay Debt", 
         caption = "Created by McBert") + 
    scale_fill_manual(values = c("#F5896E", "#7BDCFF")) + 
    theme_minimal()
```

## AMT CREDIT 
- 이번에는 대출 잔액을 확인해본다. 
```{r}
summary(train$AMT_CREDIT)
```
- 데이터의 분포도를 그려보도록 한다. 
```{r}
train %>% 
  ggplot(aes(x = AMT_CREDIT)) + 
  geom_histogram(bins = 30, fill = "#F5896E") + 
  labs(x = "Amount Credit", 
       y = "Count", 
       title = "Distribution of Amount Credit", 
       caption = "Created by McBert") + 
  theme_minimal()
```
- 이상치를 제거하도록 한다. 
  + 상위 2.5%는 제거하도록 한다. 

```{r}
upper_threshold = quantile(train$AMT_CREDIT, 0.975)
cat("Top 2.5% threshold is:", upper_threshold)

train %>% 
  filter(AMT_CREDIT <= upper_threshold) %>% 
  ggplot(aes(x = AMT_CREDIT)) + 
  geom_histogram(bins = 30, fill = "#F5896E") + 
  labs(x = "Amount Credit", 
       y = "Count", 
       title = "Distribution of Amount Credit", 
       caption = "Created by McBert") + 
  theme_minimal()
```

## TARGET ~ Age, Gender, Status 
- 이번에는 조건문을 활용하여 데이터를 요약하고, 시각화를 진행해본다. 
```{r}
train$DAYS_BIRTH[1:5]
```

```{r}
train$CODE_GENDER[1:5]
```

```{r}
table(train$CNT_FAM_MEMBERS)
```

```{r}
table(train$NAME_FAMILY_STATUS)
```



```{r}
train %>% 
  filter(!is.na(TARGET), CODE_GENDER != "XNA", CNT_FAM_MEMBERS <= 4) %>% # nrow() ~ 303498
  group_by(age = -round(DAYS_BIRTH/365, 0), 
           gender = ifelse(CODE_GENDER == "M", "Male", "Female"), 
           status = ifelse(NAME_FAMILY_STATUS == "Civil marriage", "Married", 
                           ifelse(NAME_FAMILY_STATUS == "Single / not married", "Single", as.character(NAME_FAMILY_STATUS)))) %>% # select(NAME_FAMILY_STATUS)
  summarise(count = n(), 
            AVG_CREDIT = mean(AMT_CREDIT), 
            AVG_TARGET = mean(TARGET)) %>% 
  mutate(AVG_TARGET = pmin(pmax(AVG_TARGET, 0.00), 0.20) * 100) %>% 
  ggplot(aes(x = age, y = count, fill = AVG_TARGET)) + 
    geom_histogram(stat = "identity", width = 1) + 
    facet_grid(gender ~ status) + 
    scale_fill_gradient("Avg. Default Rate %", low = "white", high = "blue") + 
    labs(title = "Default Rate of Applicants (N = 303,498)", 
         subtitle = "Age, Gender, And Marriage Status", 
         caption = "Created by McBert") +   
    theme_minimal()
```
- 상대적으로 Single, Male 그룹이 다른 그룹보다 Default 비율이 높았다. 
- 또한, 상대적으로 연령대가 낮을수록 Default 비율이 높았다. 

## Dept/Incomes Ratio %
- Dept의 비율이 높으면 높으수록 Default 비율도 높을 것으로 예상할 수 있다. 실제로 그런지 확인해본다. 
```{r}
library(scales)
train %>% 
  filter(!is.na(TARGET), CODE_GENDER != "XNA", CNT_FAM_MEMBERS <= 4) %>% 
  mutate(CODE_GENDER = ifelse(CODE_GENDER == "M", "Male", "Female"), 
         DEPT_INCOMES_RATIO = AMT_ANNUITY/AMT_INCOME_TOTAL) %>% 
  select(CODE_GENDER, DEPT_INCOMES_RATIO, TARGET) %>%
  ggplot(aes(x = DEPT_INCOMES_RATIO, y = TARGET)) + 
    geom_smooth(se = FALSE) + 
    scale_x_continuous(name = "Debt / Incomes Ratio (%)", 
                       limits = c(0, 0.5), 
                       labels = percent_format(accuracy = 0.1)) + 
    # coord_cartesian(ylim=c(0.00, 0.15)) + 
    scale_y_continuous(name = "Avg. Default Rate (%)", 
                       breaks = seq(0, 1, 0.01), 
                       labels = percent_format(accuracy = 0.1)) + 
    facet_grid(~ CODE_GENDER) + 
    labs(title = "Default Rate by Dept/Incomes Ratio (N = 303,498)", 
         subtitle = "The Comparison between Female and Male", 
         caption = "Created by McBert") +
    theme_minimal()
```

## Bureau Data

## (과제) 개인별 시각화 인사이트 찾기
- 지금까지의 작성방법을 토대로 다양하게 시각화를 작성해본다. 

# 
